<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Interactive Mobile Pokédex</title>
  <style>
    /* Full‑screen, no scroll */
    html, body { margin:0; padding:0; height:100%; overflow:hidden; }
    #canvas-container { position:relative; width:100%; height:100%; }
    /* Transparent canvas so you can change body bg */
    canvas { background:transparent; touch-action:none; }
    /* Bottom‑sheet styling (plain‑bottom‑sheet‑core defaults) */
    .pbs-backdrop { background: rgba(0,0,0,0.2); }
    .pbs-content { padding:1rem; font-family:sans-serif; }
    .pbs-handle { width:40px; height:4px; background:#ccc; border-radius:2px; margin:0.25rem auto; }
    /* Info panel typography */
    #sheet h2 { margin-top:0; text-transform: capitalize; }
    #sheet ul { padding-left:1.2rem; margin:0.5rem 0; }
    #sheet li { margin:0.2rem 0; }
    /* File‑picker button */
    #upload-btn {
      position: absolute; top:1rem; right:1rem;
      background: rgba(0,0,0,0.5); color:#fff;
      border:none; padding:0.5rem; border-radius:5px;
      font-size:0.9rem; z-index:10;
    }
  </style>

  <!-- Core libraries from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
  <link  href="https://unpkg.com/plain-bottom-sheet-core@1.0.0/dist/plain-bottom-sheet-core.min.css" rel="stylesheet"/>
  <script src="https://unpkg.com/plain-bottom-sheet-core@1.0.0/dist/plain-bottom-sheet-core.min.js"></script>
</head>
<body>
  <!-- Canvas Container -->
  <div id="canvas-container">
    <canvas id="c"></canvas>
    <button id="upload-btn">+ Overlay</button>
  </div>

  <!-- Bottom Sheet (hidden by default) -->
  <div id="sheet">
    <div class="pbs-handle"></div>
    <div class="pbs-content">
      <h2 id="name"></h2>
      <p id="flavor"></p>
      <div><strong>Types:</strong> <span id="types"></span></div>
      <div><strong>Stats:</strong> <span id="stats"></span></div>
      <div><strong>Moves:</strong>
        <ul id="moves"></ul>
      </div>
      <div><strong>Evolutions:</strong>
        <ul id="evo"></ul>
      </div>
    </div>
  </div>

  <script>
  (async function(){
    // 1) Initialize Fabric Canvas
    const canvas = new fabric.Canvas('c', { preserveObjectStacking: true });
    window.addEventListener('resize', resizeCanvas);
    function resizeCanvas(){
      canvas.setWidth(window.innerWidth);
      canvas.setHeight(window.innerHeight);
      canvas.renderAll();
    }
    resizeCanvas();

    // 2) Fetch Pokémon #1 (Bulbasaur) as default—you can change `id` or add a selector
    const id = 1;
    const p     = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`).then(r=>r.json());
    const sp    = await fetch(p.species.url).then(r=>r.json());

    // 3) Load sprite onto canvas
    const imgObj = await new Promise(res=>{
      fabric.Image.fromURL(p.sprites.front_default, img=>{
        img.set({
          left: canvas.width/2,
          top:  canvas.height/3,
          originX: 'center',
          originY: 'center',
          selectable: true
        });
        res(img);
      });
    });
    canvas.add(imgObj).setActiveObject(imgObj);

    // 4) Enable touch gestures via Hammer.js
    const hm = new Hammer(canvas.upperCanvasEl);
    hm.get('pinch').set({ enable:true });
    hm.on('pinch pinchmove rotate pan', ev => {
      const obj = canvas.getActiveObject();
      if (!obj) return;
      if (ev.type.startsWith('pinch')){
        obj.scale(ev.scale);
      }
      if (ev.type === 'rotate'){
        obj.set('angle', ev.rotation);
      }
      if (ev.type === 'pan'){
        obj.set({
          left: obj.left + ev.deltaX,
          top:  obj.top  + ev.deltaY
        });
        hm.get('pan').set({ deltaX:0, deltaY:0 });
      }
      canvas.renderAll();
    });

    // 5) Upload overlay images
    document.getElementById('upload-btn').onclick = ()=>{
      const inp = document.createElement('input');
      inp.type = 'file';
      inp.accept = 'image/*';
      inp.onchange = e=>{
        const file = e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        fabric.Image.fromURL(url, img=>{
          img.set({
            left:  canvas.width/2,
            top:   canvas.height/2,
            originX:'center',
            originY:'center',
            scaleX:0.5,
            scaleY:0.5
          });
          canvas.add(img).setActiveObject(img);
          canvas.renderAll();
        });
      };
      inp.click();
    };

    // 6) Prepare Bottom Sheet info
    const sheet = new PlainBottomSheetCore('#sheet');
    document.getElementById('name').textContent = `#${p.id} ${p.name}`;
    // Flavor text (first English entry)
    document.getElementById('flavor').textContent = 
      sp.flavor_text_entries.find(f=>f.language.name==='en').flavor_text.replace(/\n|\f/g,' ');
    // Types
    document.getElementById('types').textContent = p.types.map(t=>t.type.name).join(', ');
    // Stats
    document.getElementById('stats').textContent = 
      p.stats.map(s=>`${s.stat.name}:${s.base_stat}`).join('  ');
    // Moves (first 10)
    p.moves.slice(0,10).forEach(m=>{
      const li = document.createElement('li');
      li.textContent = m.move.name;
      document.getElementById('moves').append(li);
    });
    // Evolution chain
    const evoChainData = await fetch(sp.evolution_chain.url).then(r=>r.json());
    const evoNames = [];
    (function recurse(node){
      evoNames.push(node.species.name);
      node.evolves_to.forEach(recurse);
    })(evoChainData.chain);
    evoNames.forEach(name=>{
      const li = document.createElement('li');
      li.textContent = name;
      document.getElementById('evo').append(li);
    });

    // 7) Show sheet on canvas tap
    canvas.on('mouse:down', ()=> sheet.show());

  })();
  </script>
</body>
</html>
