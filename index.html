<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pixel Pok√©dex</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: #f2f2f2;
      font-family: 'Press Start 2P', cursive;
      color: #333;
      display: flex; flex-direction: column;
    }

    #ribbon {
      text-align: center;
      background: #d22c2c;
      color: white;
      padding: 0.75rem;
      font-size: 0.75rem;
      border-bottom: 4px solid #8b0000;
      box-shadow: 0 4px 0 #8b0000;
      cursor: pointer;
      position: relative;
    }

    #dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0; right: 0;
      max-height: 300px;
      overflow-y: auto;
      background: #fff;
      z-index: 20;
      border: 2px solid #8b0000;
      font-family: sans-serif;
      font-size: 0.8rem;
    }

    #dropdown input {
      width: 96%;
      margin: 0.5rem;
      padding: 0.4rem;
      font-size: 1rem;
    }

    #dropdown ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #dropdown li {
      padding: 0.4rem;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }

    #dropdown li:hover {
      background: #eee;
    }

    #viewer {
      position: relative;
      flex: 1;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #sprite-container {
      width: 300px;
      height: 300px;
      perspective: 800px;
    }

    .sprite {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
    }

    .sprite.flipped {
      transform: rotateY(180deg);
    }

    .sprite img {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0; left: 0;
      backface-visibility: hidden;
      image-rendering: pixelated;
    }

    #back {
      transform: rotateY(180deg);
    }

    #spinner {
      position: absolute;
      width: 64px;
      height: 64px;
      background: url('https://archives.bulbagarden.net/media/upload/0/0d/Pok√©_Ball_icon.png') center/contain no-repeat;
      animation: spin 1s linear infinite;
      display: none;
      z-index: 10;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    #controls {
      background: #eee;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0.5rem;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    button {
      font-family: 'Press Start 2P', cursive;
      font-size: 0.6rem;
      padding: 0.6rem 0.8rem;
      background: #fdfdfd;
      border: 2px solid #555;
      box-shadow: 2px 2px 0 #000;
      cursor: pointer;
    }

    button:hover {
      background: #ffcccb;
    }

    #info {
      background: #fff;
      border-top: 2px solid #ccc;
      padding: 0.5rem;
      font-family: sans-serif;
      font-size: 0.9rem;
      overflow-y: auto;
      max-height: 40%;
    }

    #types span {
      display: inline-block;
      margin: 2px;
      padding: 2px 6px;
      border-radius: 4px;
      background: #ccc;
      color: #fff;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 0.75rem;
    }
  </style>
</head>
<body>

  <div id="ribbon">Loading Pok√©dex Entry...
    <div id="dropdown">
      <input type="text" placeholder="Search Pok√©mon..." id="filterInput">
      <ul id="pokeList"></ul>
    </div>
  </div>

  <div id="viewer">
    <div id="spinner"></div>
    <div id="sprite-container">
      <div class="sprite" id="sprite">
        <img id="front" src="" alt="Front Sprite">
        <img id="back" src="" alt="Back Sprite">
      </div>
    </div>
  </div>

  <div id="controls">
    <button id="prev">‚óÄÔ∏è Prev</button>
    <button id="flip">üîÑ Flip</button>
    <button id="next">Next ‚ñ∂Ô∏è</button>
    <button id="random">‚ùì Random</button>
    <input type="file" id="upload" accept="image/*">
  </div>

  <div id="info">
    <h2 id="name"></h2>
    <div><strong>Types:</strong> <span id="types"></span></div>
    <div><strong>Flavor:</strong> <p id="flavor"></p></div>
    <div><strong>Stats:</strong> <p id="stats"></p></div>
    <div><strong>Moves:</strong> <ul id="moves"></ul></div>
    <div><strong>Evolutions:</strong> <ul id="evo"></ul></div>
  </div>

  <script>
    (function(){
      let currentId = 1;
      const maxId = 1010;
      let pokemonList = [];

      const ribbon = document.getElementById('ribbon');
      const dropdown = document.getElementById('dropdown');
      const pokeList = document.getElementById('pokeList');
      const filterInput = document.getElementById('filterInput');

      const spriteWrapper = document.getElementById('sprite');
      const frontImg = document.getElementById('front');
      const backImg = document.getElementById('back');
      const spinner = document.getElementById('spinner');

      const nameEl = document.getElementById('name');
      const typesEl = document.getElementById('types');
      const flavorEl = document.getElementById('flavor');
      const statsEl = document.getElementById('stats');
      const movesEl = document.getElementById('moves');
      const evoEl = document.getElementById('evo');

      document.getElementById('prev').onclick = () => {
        currentId = currentId > 1 ? currentId - 1 : maxId;
        loadPokemon(currentId);
      };
      document.getElementById('next').onclick = () => {
        currentId = currentId < maxId ? currentId + 1 : 1;
        loadPokemon(currentId);
      };
      document.getElementById('flip').onclick = () => {
        spriteWrapper.classList.toggle('flipped');
      };
      document.getElementById('random').onclick = () => {
        currentId = Math.floor(Math.random() * maxId) + 1;
        loadPokemon(currentId);
      };
      document.getElementById('upload').onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        const url = URL.createObjectURL(file);
        frontImg.src = url;
        backImg.src = '';
      };

      ribbon.onclick = () => {
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      };

      filterInput.oninput = () => {
        const term = filterInput.value.toLowerCase();
        pokeList.innerHTML = '';
        pokemonList
          .filter(p => p.name.includes(term) || p.id.toString().includes(term))
          .forEach(p => {
            const li = document.createElement('li');
            li.textContent = `#${p.id} ${p.name}`;
            li.onclick = () => {
              currentId = p.id;
              dropdown.style.display = 'none';
              loadPokemon(currentId);
            };
            pokeList.appendChild(li);
          });
      };

      async function preloadList() {
        const res = await fetch('https://pokeapi.co/api/v2/pokemon?limit=1010');
        const data = await res.json();
        pokemonList = data.results.map((p, i) => ({ name: p.name, id: i + 1 }));
        filterInput.dispatchEvent(new Event('input')); // Fill list
      }

      async function loadPokemon(id){
        spinner.style.display = 'block';
        ribbon.textContent = 'Loading...';
        spriteWrapper.classList.remove('flipped');

        try {
          const p = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`).then(r=>r.json());
          const sp = await fetch(p.species.url).then(r=>r.json());

          frontImg.src = p.sprites.front_default || '';
          backImg.src = p.sprites.back_default || '';
          ribbon.textContent = `#${p.id} ‚Äî ${p.name.toUpperCase()}`;

          typesEl.innerHTML = '';
          p.types.forEach(t => {
            const span = document.createElement('span');
            span.style.background = typeColor(t.type.name);
            span.textContent = t.type.name;
            typesEl.appendChild(span);
          });

          const entry = sp.flavor_text_entries.find(e => e.language.name === 'en');
          flavorEl.textContent = entry ? entry.flavor_text.replace(/[\n\f]/g, ' ') : 'No description.';

          statsEl.textContent = p.stats.map(s => `${s.stat.name}: ${s.base_stat}`).join(' | ');

          movesEl.innerHTML = '';
          p.moves.slice(0, 5).forEach(m => {
            const li = document.createElement('li');
            li.textContent = m.move.name;
            movesEl.appendChild(li);
          });

          evoEl.innerHTML = '';
          const chain = await fetch(sp.evolution_chain.url).then(r => r.json());
          (function walk(node){
            const li = document.createElement('li');
            li.textContent = node.species.name;
            evoEl.appendChild(li);
            node.evolves_to.forEach(walk);
          })(chain.chain);

        } catch (e) {
          ribbon.textContent = 'Error loading Pok√©mon.';
          console.error(e);
        } finally {
          spinner.style.display = 'none';
        }
      }

      function typeColor(type){
        const colors = {
          fire: '#f08030', water: '#6890f0', grass: '#78c850', electric: '#f8d030',
          ice: '#98d8d8', fighting: '#c03028', poison: '#a040a0', ground: '#e0c068',
          flying: '#a890f0', psychic: '#f85888', bug: '#a8b820', rock: '#b8a038',
          ghost: '#705898', dragon: '#7038f8', dark: '#705848', steel: '#b8b8d0',
          fairy: '#ee99ac', normal: '#a8a878'
        };
        return colors[type] || '#888';
      }

      preloadList();
      loadPokemon(currentId);
    })();
  </script>
</body>
</html>
